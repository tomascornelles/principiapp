!function(e){var t={inject:function(t,n,o,i){var u,p=null;return i&&t?(u=r.$type(n,o),n.hasOwnProperty("$cell")&&(p=t,p.parentNode&&p.parentNode.replaceChild(u,p)),p=u):n.$type&&("head"===n.$type||"body"===n.$type)&&e.document.getElementsByTagName(n.$type)?p=e.document.getElementsByTagName(n.$type)[0]:n.id&&e.document.getElementById(n.id)&&(p=e.document.getElementById(n.id),p.nodeName.toLowerCase()!==(n.$type||"div")&&(u=r.$type(n,o),p.parentNode.replaceChild(u,p),p=u)),p&&!p.Meta&&(p.Meta={}),p},add:function(e,t,n,o){var i=r.$type(t,o);return null!==n&&void 0!==n&&e.childNodes&&e.childNodes[n]?e.insertBefore(i,e.childNodes[n]):e.appendChild(i),i},build:function(e,n,o,r,i){var u=t.inject(e,n,r,i);return u?u:t.add(e,n,o,r)}},n={set:function(e,t,n){-1===["$init"].indexOf(t)?e.Genotype[t]=i.bind(e,n):e.Genotype[t]=n},update:function(e,t,o){i.queue(e,t,"w"),n.set(e,t,o)},build:function(e,t,o){e.Genotype={},e.Inheritance=o;for(var r in t)n.set(e,r,t[r])}},o={freeze:function(e){var t=[],n=JSON.stringify(e,function(e,n){if("function"==typeof n)return n.toString();if("object"==typeof n&&null!==n){if(-1!==t.indexOf(n))return"[Circular]";t.push(n)}return n});return t=null,n},LCS:function(e,t){var n,r,i=e.length,u=t.length,p=[],c=[],a=[];for(n=0;i>n;n++)c.push(o.freeze(e[n]));for(r=0;u>r;r++)a.push(o.freeze(t[r]));for(n=0;i>=n;n++)p.push([0]);for(r=0;u>r;r++)p[0].push(0);for(n=0;i>n;n++)for(r=0;u>r;r++)p[n+1][r+1]=c[n]===a[r]?p[n][r]+1:Math.max(p[n+1][r],p[n][r+1]);return function f(t,n){return t*n===0?[]:c[t-1]===a[n-1]?f(t-1,n-1).concat([{item:e[t-1],_old:t-1,_new:n-1}]):p[t][n-1]>p[t-1][n]?f(t,n-1):f(t-1,n)}(i,u)},diff:function(e,t){var n=o.LCS(e,t),r=n.map(function(e){return e._old}),i=e.map(function(e,t){return{item:e,index:t}}).filter(function(e,t){return-1===r.indexOf(t)}),u=n.map(function(e){return e._new}),p=t.map(function(e,t){return{item:e,index:t}}).filter(function(e,t){return-1===u.indexOf(t)});return{"-":i,"+":p}}},r={build:function(e,t){for(var n in t)null!==t[n]&&void 0!==t[n]&&r.set(e,n,t[n]);r.$init(e)},multiline:function(e){return/\/\*!?(?:@preserve)?[ \t]*(?:\r\n|\n)([\s\S]*?)(?:\r\n|\n)[ \t]*\*\//.exec(e.toString())[1]},set:function(t,n,o){if("$"===n[0])if("$type"===n){var i=t.tagName?t.tagName.toLowerCase():"text";if(o.toLowerCase()!==i){var u=r.$type({$type:"fragment"}),p=u.$build(t.Genotype,t.Inheritance,null,t.Meta.namespace);t.parentNode.replaceChild(p,t),t=p}}else"$text"===n?("function"==typeof o&&(o=r.multiline(o)),t.textContent=o):"$html"===n?("function"==typeof o&&(o=r.multiline(o)),t.innerHTML=o):"$components"===n&&r.$components(t,o);else if("_"===n[0]);else if("value"===n)t[n]=o;else if("style"===n&&"object"==typeof o){var c=Object.getOwnPropertyDescriptor(e.HTMLElement.prototype,n).get.call(t);for(var a in o)c[a]=o[a]}else"number"==typeof o||"string"==typeof o||"boolean"==typeof o?t.setAttribute&&t.setAttribute(n,o):"function"==typeof o&&(t[n]=o)},$type:function(t,n){var o,i={};return"text"===t.$type?(t.$text&&"function"==typeof t.$text&&(t.$text=r.multiline(t.$text)),o=e.document.createTextNode(t.$text)):"svg"===t.$type?(o=e.document.createElementNS("http://www.w3.org/2000/svg",t.$type),i.namespace=o.namespaceURI):n?(o=e.document.createElementNS(n,t.$type),i.namespace=o.namespaceURI):o="fragment"===t.$type?e.document.createDocumentFragment():e.document.createElement(t.$type||"div"),o.Meta=i,o},$components:function(e,t){t||(t=[]);var n=[].map.call(e.childNodes,function(e){return e.Genotype}).filter(function(e){return e});if(n.length>0){var i=o.diff(n,t);i["-"].forEach(function(t){e.childNodes[t.index].Kill=!0}),[].filter.call(e.childNodes,function(e){return e.Kill}).forEach(function(t){e.removeChild(t)}),i["+"].forEach(function(t){var n=e.Inheritance;for(var o in e.Genotype)"_"===o[0]&&(n=n.concat([o]));e.$build(t.item,n,t.index,e.Meta.namespace),e.$components[t.index]=e.childNodes[t.index].Genotype})}else{var u=r.$type({$type:"fragment"}),p=e.Inheritance;for(var c in e.Genotype)"_"===c[0]&&(p=p.concat([c]));for(;e.firstChild;)e.removeChild(e.firstChild);t.forEach(function(t){u.$build(t,p,null,e.Meta.namespace)}),e.appendChild(u),e.$components=[].map.call(e.childNodes,function(e){return e.Genotype})}},$init:function(t){i.tick.call(e,function(){t.Genotype&&t.Genotype.$init&&i.bind(t,t.Genotype.$init)()})},$update:function(e){if(e.parentNode&&!e.Meta.$updated&&e.$update){e.Meta.$updated=!0,e.$update();for(var t in e.Dirty)r.set(e,t,e.Genotype[t]);e.Meta.$updated=!1,e.Dirty=null}}},i={tick:e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.msRequestAnimationFrame||function(t){return e.setTimeout(t,1e3/60)},set:function(t,o){Object.defineProperty(t,o,{configurable:!0,get:function(){if("$"!==o[0]&&"_"!==o[0])return"value"===o?Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),o).get.call(t):"style"===o?Object.getOwnPropertyDescriptor(e.HTMLElement.prototype,o).get.call(t):o in t.Genotype?t.Genotype[o]:Object.getOwnPropertyDescriptor(e.HTMLElement.prototype,o).get.call(t);if(o in t.Genotype)return i.queue(t,o,"r"),t.Genotype[o];if("_"!==o[0])return null;for(var n=t;n=n.parentNode;)if(n&&n.Genotype&&o in n.Genotype)return i.queue(n,o,"r"),n.Genotype[o]},set:function(r){var i=t;if(!(o in t.Genotype)&&"_"===o[0])for(;(i=i.parentNode)&&!(i&&i.Genotype&&o in i.Genotype););if(n.update(i,o,r),"$"!==o[0]&&"_"!==o[0]){if("value"===o)return Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),o).set.call(t,r);"style"===o&&"object"==typeof r?Object.getOwnPropertyDescriptor(e.HTMLElement.prototype,o).set.call(t,r):"number"==typeof r||"string"==typeof r||"boolean"==typeof r?t.setAttribute(o,r):"function"==typeof r&&Object.getOwnPropertyDescriptor(e.HTMLElement.prototype,o).set.call(t,r)}}})},build:function(e){["$type","$text","$html","$components"].forEach(function(t){t in e.Genotype||i.set(e,t)}),e.Inheritance&&e.Inheritance.forEach(function(t){i.set(e,t)});for(var t in e.Genotype)i.set(e,t)},_queue:[],bind:function(t,n){return"function"==typeof n?function(){return i.tick.call(e,function(){i._queue.forEach(function(e){var t=!1;for(var n in e.Dirty)o.freeze(e.Genotype[n])!==e.Dirty[n]&&(r.set(e,n,e.Genotype[n]),"_"===n[0]&&(t=!0));t&&"$update"in e.Genotype&&"function"==typeof e.Genotype.$update?r.$update(e):e.Dirty=null});var e=i._queue.indexOf(t);-1!==e&&i._queue.splice(e,1)}),n.apply(t,arguments)}:n},queue:function(e,t,n){var r=e.Genotype[t];("r"!==n||"object"==typeof r||Array.isArray(r))&&(-1===i._queue.indexOf(e)&&i._queue.push(e),e.Dirty||(e.Dirty={}),t in e.Dirty||(e.Dirty[t]=o.freeze(e.Genotype[t])))}},u={detect:function(t){return void 0===t&&(t=this),Object.keys(t).filter(function(n){try{return/webkitStorageInfo|webkitIndexedDB/.test(n)||t[n]instanceof e.Element?!1:t[n]&&Object.prototype.hasOwnProperty.call(t[n],"$cell")}catch(o){return!1}}).map(function(e){return t[e]})},plan:function(o){void 0===o?o=e:e=o,o.DocumentFragment.prototype.$build=o.Element.prototype.$build=function(e,o,u,p,c){var a=t.build(this,e,u,p,c);return n.build(a,e,o||[],u),i.build(a),r.build(a,a.Genotype),a},o.DocumentFragment.prototype.$cell=o.Element.prototype.$cell=function(e,t){return this.$build(e,[],null,t&&t.namespace||null,!0)},e.NodeList&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach)},create:function(e){return u.detect(e).map(function(t){return e.document.body.$build(t,[])})}};if("undefined"!=typeof exports){var p={Phenotype:r,Genotype:n,Nucleus:i,Gene:o,Membrane:t,God:u,plan:u.plan.bind(u),create:u.create.bind(u)};"undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports=p}else u.plan(this),this.addEventListener&&this.addEventListener("load",function(){u.create(this)})}(this);